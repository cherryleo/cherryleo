---
weight: 10
title: "Borg翻译（一）"
date: "2018-11-12"
lastmod: "2018-11-12"
description:  "Borg是谷歌2015年发表的关于大规模集群管理的论文，Kubernetes是谷歌Borg系统的开源实现"
categories:  ["kubernetes"]
tags: ["kubernetes"]
---

## 利用率

Borg的主要目标之一是有效利用谷歌的机器，谷歌在机器的投资上是巨大的，提高几个百分点的利用率可以节省数百万美元。
本节讨论并评估Borg如何提高机器利用率的一些策略和技术。

## 评估方法

我们的作业有放置限制，需要处理罕见的工作负载峰值，我们的机器是异构的，我们在从服务作业回收的资源中运行批处理作业。
因此，为了评估我们的选择的策略，我们需要一个比“平均利用率”更精密的指标。

经过大量的实验，我们选择了单元压实（cell compaction）：
给定一个工作负载，我们通过移除机器直到工作负载不再适应，发现它可以装入多小的单元，
从头开始重新打包工作负载以确保我们没有挂在一个不吉利的配置上。
这提供了清洁的终止条件，并促进了自动比较，而没有合成工作负荷生成和建模的缺陷

不可能在现场生产单元上进行实验，但我们使用Fauxmaster来获取高保真模拟结果，
使用来自真实生产单元和工作负载的数据，包括所有约束，实际限制，预留和实际使用的数据。
这些数据来自2014年1月14日星期三14:00 PDT拍摄的博格检查站。（其他检查点产生了类似的结果。）
我们选择15个Borg细胞进行报告，首先消除特殊用途，测试和小型（<5000台机器）细胞，
然后对剩余种群进行取样，以实现大致均匀的扩散范围。大小。

为了保持压实单元中的机器异质性，我们随机选择要移除的机器。为了保持工作负载的异构性，
我们保留了所有这些，除了与特定机器（例如Borglets）相关的服务器和存储任务。
对于大于原始单元大小一半的作业，我们将硬约束更改为软约束，如果它们非常“挑剔”并且只能放在少数机器上，
则允许高达0.2％的任务等待处理。大量实验表明，这产生了可重复的结果，方差很小。
如果我们需要比原来更大的细胞，我们在压实前几次克隆了原始细胞;如果我们需要更多细胞，我们只是克隆了原始细胞。

对于具有不同随机数种子的每个细胞，每个实验重复11次。在图表中，我们使用错误条显示所需机器数量的最小值和最大值，
并选择90％ile值作为“结果” - 均值或中位数不会反映系统管理员的内容- 
如果他们想要合理地确定工作量适合，那么istrator会这样做。
我们认为单元压缩提供了一种公平，一致的方式来比较调度策略，
并且它直接转换为成本/收益结果：更好的策略需要更少的机器来运行相同的工作负载。

我们的实验侧重于从某个时间点调度（打包）工作负载，而不是重放长期工作负载跟踪。
这部分是为了避免应对开放和封闭排队模型的困难，部分原因是传统的完成时间指标不适用于我们的环境及其长期运行的服务，
部分原因是为了提供清晰的信号进行比较，部分原因是我们不相信结果会有显着差异，
而且部分是实际问题：我们发现自己在某一时刻为我们的实验消耗了20万个Borg CPU内核 - 
即使在谷歌的规模上，这也是一项非常重要的投资。

在生产中，我们故意为工作负载增长，偶尔的“黑天鹅”事件，负载峰值，机器故障，
硬件升级和大规模部分故障（例如，电源总线管道）留下很大的空间。
图4显示了如果我们将细胞压缩应用于它们，我们的真实世界细胞会变小多少。以下图表中的基线使用这些紧凑的大小。